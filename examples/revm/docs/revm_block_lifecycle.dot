digraph revm_block_lifecycle {
  rankdir=LR;
  splines=true;
  nodesep=0.5;
  ranksep=0.6;
  fontname="Helvetica";
  fontsize=12;

  node [
    shape=box,
    style="rounded,filled",
    fillcolor="white",
    color="#666666",
    fontname="Helvetica",
    fontsize=10
  ];
  edge [
    color="#555555",
    fontname="Helvetica",
    fontsize=9,
    arrowsize=0.7
  ];

  subgraph cluster_flow {
    label="Block lifecycle (one height)";
    style="rounded,filled";
    color="#D9E7FF";
    fillcolor="#F3F7FF";

    P1[label="1. Build proposal\n(mempool + parent snapshot)"];
    P2[label="2. execute_txs\n(REVM)"];
    P3[label="3. compute_root + cache snapshot"];
    M1[label="4. Marshal disseminates\nblock + backfill"];
    C1[label="5. Simplex orders digest"];
    F1[label="6. FinalizedReporter\nreplays + validates"];
    S1[label="7. Persist to QMDB\n+ prune mempool"];

    P1 -> P2 -> P3;
    P3 -> M1;
    P3 -> C1;
    M1 -> F1;
    C1 -> F1;
    F1 -> S1;
  }
}
