<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>commonware > Reconfiguration + Reshare with threshold consensus::simplex</title>
    <meta name="description" content="An ongoing challenge with maintaining distributed validator sets is reconfiguring the validator committee (adding and removing validators), and in turn, refreshing secret key material amongst active participants. Networks need to expand and contract the committee without pausing; Validator committees are rarely static in practice, e.g. to allow for staking/unstaking on Proof of Stake networks, or rotating the authorities on Proof of Authority networks.">
    <meta name="author" content="Ben Clabby">
    <meta name="keywords" content="commonware, open source, common goods, software, internet, ownership, trust, blockchain, decentralization, crypto">

    <meta property="og:url" content="https://commonware.xyz/blogs/reshare.html" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="commonware" />
    <meta property="og:image" content="https://commonware.xyz/imgs/reshare.png" />
    <meta property="og:title" content="Reconfiguration + Reshare with threshold consensus::simplex" />
    <meta property="og:description" content="An ongoing challenge with maintaining distributed validator sets is reconfiguring the validator committee (adding and removing validators), and in turn, refreshing secret key material amongst active participants. Networks need to expand and contract the committee without pausing; Validator committees are rarely static in practice, e.g. to allow for staking/unstaking on Proof of Stake networks, or rotating the authorities on Proof of Authority networks." />
    <meta property="article:author" content="https://x.com/vex_0x" />
    <meta property="article:published_time" content="2025-10-15T00:00:00Z" />
    <meta property="article:modified_time" content="2025-10-15T00:00:00Z" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content="commonware.xyz" />
    <meta property="twitter:url" content="https://commonware.xyz/blogs/reshare.html" />
    <meta property="twitter:title" content="Reconfiguration + Reshare with threshold consensus::simplex" />
    <meta property="twitter:description" content="An ongoing challenge with maintaining distributed validator sets is reconfiguring the validator committee (adding and removing validators), and in turn, refreshing secret key material amongst active participants. Networks need to expand and contract the committee without pausing; Validator committees are rarely static in practice, e.g. to allow for staking/unstaking on Proof of Stake networks, or rotating the authorities on Proof of Authority networks." />
    <meta property="twitter:image" content="https://commonware.xyz/imgs/reshare.png" />
    <meta property="twitter:site" content="@commonwarexyz" />
    <meta property="twitter:creator" content="@vex_0x" />

    <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>
    <div id="logo-placeholder">
        <div class="logo-line">
            <span class="edge-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="edge-logo-symbol">*</span>
        </div>
        <div class="logo-line">
            <span class="vertical-logo-symbol">|</span>
            <span class="logo-text"> commonware </span>
            <span class="vertical-logo-symbol"> </span>
        </div>
        <div class="logo-line">
            <span class="edge-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="edge-logo-symbol">+</span>
        </div>
    </div>
    <div class="content">
        <h1>Once a Validator, Not Always a Validator</h1>
        <div class="meta">
            <div class="author">By <a href="https://x.com/vex_0x">Ben Clabby</a></div>
            <div class="date">October 15, 2025</div>
        </div>
        <p>
            Most consensus protocols (TODO: add links) are described under the permissioned setting (where all participants are fixed and known ahead of time).
            Safely transitioning from one permissioned set to another, as participants are added and removed, is left as an exercise for the reader.
        </p>
        <p>
            Sometimes this transition is obvious, as in Tendermint. Participants only start working on another height once the previous height is finalized.
            This makes it safe to transition as soon as finalization is observed. Newer protocols, like Simplex, that offer faster-than-finality views, begin
            working on the next height as soon as the previous height is notarized (rather than finalized). This makes it quite challenging to actually decide
            when to apply a new permissioned set. If it isn't known when building a block who should vote on it, divergence can lead to a halt or a safety failure.
        </p>
        <p>
            What do? A new formulation of this problem by y Jovan Komatovic, Andrew Lewis-Pye, Joachim Neu, Tim
            Roughgarden and Ertem Nusret Tas in <a href="https://arxiv.org/pdf/2506.14124"><i>From Permissioned to Proof-of-Stake Consensus</i></a> offers a generic solution
            to this problem by blackboxing consensus (allowing for the same technique to work no matter how the inner consensus is defined). Treat the global
            log as a number of segmented logs (each of epoch length) and work on finalizing each (transitioning to the next epoch when the some block at the epoch boundary
            is directly finalized).
        </p>
        <p>
            With an eye towards supporting multiple consensus protocols (TODO: link to Minimmit) in the Commonware Library, we opted to implement this generic technique.
            Recently, we added support for height-based epoching in <code>consensus::simplex</code>. This
            feature adds an <code>epoch</code> field to each consensus message, enabling an orchestrator to transition
            to a new epoch when a direct finalization for the last block in an epoch is observed. Epochs give us the
            perfect platform to perform progressive BLS key reshare to reconfigure the committee, defining an
            in-protocol border between different committees' active block heights.
        </p>
        <div class="image-container">
            <img src="/imgs/epoching.png" alt="Epoching" />
            <div class="image-caption">Figure 1: After some configurable number of blocks is finalized, a new epoch begins. If more blocks than desired are finalized, they are dropped. Epochs require direct finalization of the last block to advance,
                if this hasn't happened yet we repropose the same block. The last block of some epoch is treated as the genesis block of the next epoch.
            </div>
        </div>
        <h2>Resharing: Piggybacking on Consensus</h2>
        <p>
            In the threshold setting, changing the validator set means more than just changing the list of participants. You also need to ensure all new participants receive
            a share of the threshold secret to sign votes. Our existing VRF example (TODO: link) from a year ago demonstrates how to do this but uses a central arbiter to ensure all participants see the same commitments, acknowledgements, and reveals. To do this right, we need to remove this arbiter.
        </p>
        <h2>A refresher on threshold <code>consensus::simplex</code> and <code>examples/vrf</code></h2>
        <p>
            The threshold <code>consensus::simplex</code> module utilizes BLS threshold signatures so that a group of
            validators can sign consensus messages. Each active validator has a share of the signing key. A threshold
            of these shares is required to sign a message.
        </p>
        <p>
            <a href="https://github.com/commonwarexyz/monorepo/tree/main/examples/vrf"><code>examples/vrf</code></a>
            showcases a continuous key reshare process to generate randomness, but with one caveat: participants trust a
            central "<a href="https://docs.rs/commonware-cryptography/latest/commonware_cryptography/bls12381/dkg/arbiter/struct.Arbiter.html">Arbiter</a>"
            to ensure all participants see the same commitments, acknowledgements, and reveals.
        </p>
        <p>
            Our new <a href="https://github.com/commonwarexyz/monorepo/tree/main/examples/reshare"><code>reshare</code></a> example
            puts these ideas together, driving a DKG protocol with BLS12-381 keys through the replicated log of a
            blockchain. Validators are required to refresh their key material every epoch (a predefined
            interval of blocks) and can generate new shares for fresh participants, providing a blueprint for chains
            users of threshold <code>consensus::simplex</code> to reconfigure the validator committee securely.
        </p>
        <p>
            To safely reconfigure the validator committee in a threshold <code>consensus::simplex</code> engine,
            we use <code>cryptography::bls12381::dkg</code> to securely generate new shares for the next committee.
        </p>
        <p>
            Each epoch begins with a set of <b>dealers</b>, the active validators in the current epoch, and
            <b>players</b>, the active validators in the upcoming epoch. Dealers encrypt fresh shares to the
            upcoming committee (players), players acknowledge these shares, and anyone who misbehaves is
            flagged by participants. Those transcripts are bundled into a compact result and proposed alongside normal
            blocks.
        </p>
        <p>
            Consensus handles the rest. Once the reshare outcomes are included within finalized blocks, every
            participant will have a consistent view of the commitments, optional local share (if part of the
            current committee), and participant list for the next epoch. Rather than trusting a central Arbiter,
            like in <code>examples/vrf</code>, all players can track the results published by the dealers to
            arrive at the reshare outcome independently.
        </p>
        <div class="image-container">
            <img src="/imgs/reshare_actors.png" alt="Actor Interactions" />
            <div class="image-caption">Figure 2: Dealers and Players interact with each other and the replicated log to derive the new shares and group polynomial.</div>
        </div>
        <p>
            Driving resharing through the replicated log provides:
        <ol>
            <li><b>accountability</b>: cryptographic receipts for every dealer's outcome are included in the replicated log.</li>
            <li><b>availability</b>: the network keeps producing blocks while it prepares the next quorum, so reconfiguration/reshare does not compete with liveness.</li>
            <li><b>recoverability</b>: because dealer outcomes are persisted, any node can crash, restart, and deterministically rejoin the current epoch without side-channeled communication.</li>
        </ol>
        </p>
        <h2>Bootstrapping a Threshold Committee</h2>
        <p>
            To bootstrap the initial threshold committee, the example offers two paths: a trusted setup, where a central
            party creates and distributes the shares, or a DKG ceremony, where all participants jointly generate the
            initial shares without any single point of trust.
        </p>
        <p>
            The trusted setup is more simple, but the DKG ceremony is more secure. The DKG ceremony is facilitated
            amongst a known set of participants using ED25519 <code>consensus::simplex</code> to agree on the DKG
            transcript.
        </p>
        <img src="/imgs/dkg_bootstrap.png" alt="DKG bootstrap" />
        <p>
            After this process is complete, the initial epoch's committee can begin producing blocks under threshold
            <code>consensus::simplex</code>.
        </p>

        <h2>Trying It Locally</h2>
        <p>
            You can run the example by generating participant configurations and launching the validators with the
            command emitted by the setup step. Within a few minutes the logs will show share distributions, resumed
            consensus rounds, and epoch transitions as the network continually rotates the committee with refreshed
            shares.
        </p>
        <pre><code>
$ git clone git@github.com:commonwarexyz/monorepo.git && cd monorepo
# Trusted Setup
$ cargo run --bin commonware-reshare setup
# DKG Setup
$ cargo run --bin commonware-reshare setup --with-dkg
# Execute the `mprocs` command(s) emitted by the previous step
        </code></pre>

        <h2>What Comes Next</h2>
        <p>
            We expect builders to use their own selection rules, plug the reshare transcript into application state,
            and experiment with various reconfiguration cadences. If you take the example in a new direction, or uncover
            interesting corner cases, let us know. Validator networks should be able to evolve securely in real time,
            and this example is an invitation to make that the default.
        </p>
    </div>

    <div id="footer-placeholder"></div>
    <script src="/shared.js"></script>
</body>

</html>