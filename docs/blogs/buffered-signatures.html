<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon">

    <title>commonware > Reducing Block Time (and Resource Usage) with Buffered Signatures</title>
    <meta name="description" content="How we achieved a 20% reduction in block time, 65% reduction in CPU usage, and 27% reduction in bandwidth by rethinking when and how we verify signatures.">
    <meta name="author" content="Patrick O'Grady">
    <meta name="keywords" content="commonware, open source, common goods, software, internet, ownership, trust, blockchain, decentralization, crypto">

    <meta property="og:url" content="https://commonware.xyz/blogs/buffered-signatures.html" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="commonware" />
    <meta property="og:image" content="https://commonware.xyz/imgs/buffering.png" />
    <meta property="og:title" content="Reducing Block Time (and Resource Usage) with Buffered Signatures" />
    <meta property="og:description" content="How we achieved a 20% reduction in block time, 65% reduction in CPU usage, and 27% reduction in bandwidth by rethinking when and how we verify signatures." />
    <meta property="article:author" content="https://x.com/_patrickogrady" />
    <meta property="article:published_time" content="2025-05-28T00:00:00Z" />
    <meta property="article:modified_time" content="2025-05-28T00:00:00Z" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content="commonware.xyz" />
    <meta property="twitter:url" content="https://commonware.xyz/blogs/buffered-signatures.html" />
    <meta property="twitter:title" content="Reducing Block Time (and Resource Usage) with Buffered Signatures" />
    <meta property="twitter:description" content="How we achieved a 20% reduction in block time, 65% reduction in CPU usage, and 27% reduction in bandwidth by rethinking when and how we verify signatures." />
    <meta property="twitter:image" content="https://commonware.xyz/imgs/buffering.png" />
    <meta property="twitter:site" content="@commonwarexyz" />
    <meta property="twitter:creator" content="@_patrickogrady" />

    <link rel="stylesheet" type="text/css" href="../style.css">
</head>

<body>
    <div id="logo-placeholder">
        <div class="logo-line">
            <span class="edge-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="edge-logo-symbol">*</span>
        </div>
        <div class="logo-line">
            <span class="vertical-logo-symbol">|</span>
            <span class="logo-text"> commonware </span>
            <span class="vertical-logo-symbol"> </span>
        </div>
        <div class="logo-line">
            <span class="edge-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="edge-logo-symbol">+</span>
        </div>
    </div>
    <div class="content">
        <h1>Reducing Block Time (and Resource Usage) with Buffered Signatures</h1>
        <div class="meta">
            <div class="author">By <a href="https://x.com/_patrickogrady">Patrick O'Grady</a></div>
            <div class="date">May 28, 2025</div>
        </div>
        <p>A few months ago, we launched <a href="https://x.com/_patrickogrady/status/1901645720823935341">Alto</a>, a minimal (and wicked fast) blockchain for continuously benchmarking the <a href="https://github.com/commonwarexyz/monorepo">Commonware Library</a>. Today, I'm thrilled <a href="https://alto.commonware.xyz">to share</a> that this benchmarking drove a 20% reduction in block time (to ~200ms), a 20% reduction in block finality (to ~300ms), a 65% reduction in CPU usage, and a 27% reduction in bandwidth usage.</p>
        <p>It turns out procrastinating (or buffering) can indeed be a great strategy.</p>
        <h2>The Road to 200ms</h2>
        <p><a href="https://commonware.xyz/blogs/introducing-commonware.html">Last August</a>, we released the first <a href="https://github.com/commonwarexyz/monorepo">Commonware Library</a> primitive: <a href="https://docs.rs/commonware-p2p/latest/commonware_p2p/authenticated/index.html">p2p::authenticated</a>. Unlike traditional p2p libraries that focus on gossip-based messaging over a subset of randomly connected peers, <i>p2p::authenticated</i> provides point-to-point communication between fully-connected peers (where each connection is authenticated by a previously known public key, like the one a validator registered when staking).</p>
        <div class="image-container">
            <img src="../imgs/gossip-models.png" alt="Comparing gossip models">
            <div class="image-caption">Figure 1: Comparing gossip models</div>
        </div>
        <p>The consensus primitives <a href="https://commonware.xyz/blogs/commonware-the-anti-framework.html">we released in December</a> (<a href="https://docs.rs/commonware-consensus/latest/commonware_consensus/simplex/index.html">simplex</a>) and <a href="https://commonware.xyz/blogs/threshold-simplex.html">January</a> (<a href="https://docs.rs/commonware-consensus/latest/commonware_consensus/threshold_simplex/index.html">threshold_simplex</a>) built on top of <i>p2p::authenticated</i> but didn't do anything particularly clever with it (the point-to-point messaging alone was enough of an improvement to reach the ~250ms block time in the original Alto launch).</p>
        <p>So, what would something clever look like?</p>
        <h2>Lazy Signature Verification</h2>
        <p>Seeking to progress through consensus as fast as possible, validators typically verify signatures as soon as they receive them (sometimes even in parallel). This eager verification makes intuitive sense—you want to either enter a new view or finalize a block as soon as possible. In fact, doing anything else with a traditional gossip messaging won't work.</p>
        <div class="image-container">
            <img src="../imgs/invalid-signature-gossip.png" alt="Block peers that send invalid signatures">
            <div class="image-caption">Figure 4: Block peers that send invalid signatures</div>
        </div>
        <p>When peers are tasked with forwarding another's messages, the recipient can never be sure what they have until said messages are verified. A malicious peer could forward a message with a valid signature or tamper with it. They could hallucinate a message that a valid peer never sent (with an invalid signature). Or even block valid peers from sending any messages <a href="https://www.gemini.com/cryptopedia/eclipse-attacks-defense-bitcoin">if they eclipse you.</a> If an invalid signature is detected, the best you can do is block the immediate sender (although they can just generate a new identity and try to reconnect to you from a new address).</p>
        <p>With <i>p2p::authenticated</i>, we have the necessary functionality to do something novel: dedicated peer slots. Instead of verifying each signature individually as it arrives, we buffer them in slots dedicated to each registered peer (as each connection is point-to-point and authenticated, there is no way anyone other than said peer could fill this slot). When we collect a quorum (<i>2f+1</i>) of signatures over the same message, we perform a single multi-signature verification (or batch verification in the case of simplex).</p>
        <div class="image-container">
            <img src="../imgs/buffering.png" alt="Buffer signatures until a quorum is reached">
            <div class="image-caption">Figure 2: Buffer signatures until a quorum is reached</div>
        </div>
        <h2>Handling Invalid Signatures</h2>
        <p>This lazy aggregate verification is nice and all but now that we aren't verifying messages when they arrive over the wire, one bad apple can spoil the whole bunch. Fortunately, we have one more new tool from <i>p2p::authenticated</i> to help us: identity blocking.</p>
        <p>When a verification fails, the validator performs a binary search over the buffered signatures to identify the culprit(s). In the worst case (where <i>f</i> the signatures are invalid), this can lead to more verifications than the original eager approach. However, once identified as malicious, that peer is permanently blocked by its staking identity (and can't from a new address or bombard said validator with invalid signatures via some forwarded channel). Without this blocking, it would be trivial for a set of malicious peers to undermine this optimization (and make it worse than the original eager approach on each view). With identity blocking, this can only happen on a small number of views over the course of a typical epoch. In a week-long 3,000,000 view epoch, a validator set of 1000 could at most cause disruption in ~333 views (0.011% of views).</p>
        <div class="image-container">
            <img src="../imgs/bisection.png" alt="Search for invalid signatures via repeated bisection">
            <div class="image-caption">Figure 3: Search for invalid signatures via repeated bisection</div>
        </div>
        <h2>Reducing Block Time (and Resource Usage)</h2>
        <p>By transitioning from ~50 individual signature verifications per message to 1-2 aggregate verifications, performance has improved meaningfully (while using less resources):</p>
        <ul>
            <li><b>Block time</b>: 250ms → 200ms (20% reduction)</li>
            <li><b>Finality</b>: 375ms → 300ms (20% reduction)</li>
            <li><b>CPU usage</b>: 26% → 9% on a <a href="https://github.com/commonwarexyz/alto/tree/main/chain#create-artifacts-1">c7g.xlarge</a> (65% reduction)</li>
            <li><b>Bandwidth</b>: 27% reduction with <a href="https://github.com/commonwarexyz/monorepo/blob/19d70176b4127400d29c656a327df1d744a75dca/cryptography/src/bls12381/primitives/variant.rs#L181-L182">G1 signatures</a></li>
        </ul>
        <p>On a 4-core instance, consensus now consumes less than half a core, leaving 91% of compute available for your application (or for increasing the size of the validator set on the same hardware).</p>
        <p>Consensus should be a sideshow, don't let it be the show.</p>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../shared.js"></script>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "07159b86f75b4af18e54dd0cda2fb4a7"}'></script>
</body>

</html>