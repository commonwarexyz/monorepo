<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon">

    <title>commonware > TBD</title>
    <meta name="description" content="TBD">
    <meta name="author" content="Patrick O'Grady">
    <meta name="keywords" content="commonware, open source, common goods, software, internet, ownership, trust, blockchain, decentralization, crypto">

    <meta property="og:url" content="https://commonware.xyz/blogs/buffered-signatures.html" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="commonware" />
    <meta property="og:image" content="TBD" />
    <meta property="og:title" content="TBD" />
    <meta property="og:description" content="TBD" />
    <meta property="article:author" content="https://x.com/_patrickogrady" />
    <meta property="article:published_time" content="2025-05-28T00:00:00Z" />
    <meta property="article:modified_time" content="2025-05-28T00:00:00Z" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content="commonware.xyz" />
    <meta property="twitter:url" content="https://commonware.xyz/blogs/buffered-signatures.html" />
    <meta property="twitter:title" content="TBD" />
    <meta property="twitter:description" content="TBD" />
    <meta property="twitter:image" content="TBD" />
    <meta property="twitter:site" content="@commonwarexyz" />
    <meta property="twitter:creator" content="@_patrickogrady" />

    <link rel="stylesheet" type="text/css" href="../style.css">
</head>

<body>
    <div id="logo-placeholder">
        <div class="logo-line">
            <span class="edge-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="edge-logo-symbol">*</span>
        </div>
        <div class="logo-line">
            <span class="vertical-logo-symbol">|</span>
            <span class="logo-text"> commonware </span>
            <span class="vertical-logo-symbol"> </span>
        </div>
        <div class="logo-line">
            <span class="edge-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="edge-logo-symbol">+</span>
        </div>
    </div>
    <div class="content">
        <h1>Reducing Block Time (and Resource Usage) with Buffered Signatures</h1>
        <div class="meta">
            <div class="author">By <a href="https://x.com/_patrickogrady">Patrick O'Grady</a></div>
            <div class="date">May 28, 2025</div>
        </div>
        <p>A few months ago, we launched <a href="https://x.com/_patrickogrady/status/1901645720823935341">Alto</a>, a minimal (and wicked fast) blockchain for continuously benchmarking the <a href="https://github.com/commonwarexyz/monorepo">Commonware Library</a>. Today, I'm stoked <a href="https://alto.commonware.xyz">to share</a> that this benchmarking drove a 20% reduction in block time (to ~200ms), a 20% reduction in finality (to ~300ms), a 65% reduction in CPU usage, and a 27% reduction in bandwidth usage.</p>
        <p>Let's start by taking a step back (all the way back). <a href="https://commonware.xyz/blogs/introducing-commonware.html">Last August</a>, we released the first <a href="https://github.com/commonwarexyz/monorepo">Commonware Library</a> primitive: <a href="https://docs.rs/commonware-p2p/latest/commonware_p2p/authenticated/index.html">p2p::authenticated</a>. <i>p2p::authenticated</i>, unlike other commonly used p2p libraries, only provides point-to-point communication between fully-connected peers (authenticated by an arbitrary public key).</p>
        <div class="image-container">
            <img src="../imgs/gossip-models.png" alt="Comparing gossip models">
            <div class="image-caption">Figure 1: Comparing gossip models</div>
        </div>
        <p>The consensus primitives <a href="https://commonware.xyz/blogs/commonware-the-anti-framework.html">we released in December</a> (<a href="https://docs.rs/commonware-consensus/latest/commonware_consensus/simplex/index.html">simplex</a>) and <a href="https://commonware.xyz/blogs/threshold-simplex.html">January</a> (<a href="https://docs.rs/commonware-consensus/latest/commonware_consensus/threshold_simplex/index.html">threshold_simplex</a>) built on top of <i>p2p::authenticated</i> but didn't do anything particularly clever with its unique functionality (the introduction of point-to-point messaging alone was enough to reach the ~250ms block time in the original Alto launch).</p>
        <p>So, what would something clever look like?</p>
        <p>Typically, any validator in consensus verifies all incoming messages it receives as soon as it receives it. The sooner a message is verified, the sooner a validator may have a quorum of verified messages and thus the sooner they are able to enter a new view or finalize a block. Let's wait instead.</p>
        <div class="image-container">
            <img src="../imgs/buffering.png" alt="Buffer signatures until a quorum is reached">
            <div class="image-caption">Figure 2: Buffer signatures until a quorum is reached</div>
        </div>
        <p>Instead of verifying each message as soon as it is received, we can buffer signatures over a message until a quorum is reached and then perform a batch/aggregate verification (often dramatically more efficient than verifying all signatures individually). Because we know each consensus participant should only send 1 message of a given variety per view (and we are connected to that peer directly over <i>p2p::authenticated</i>), we just store their message in a slot allocated to exclusively that peer (something we cannot do with "traditional" gossip where a peer may forward the messages of any number of other peers). But not all signatures may be valid, is all lost?</p>
        <div class="image-container">
            <img src="../imgs/bisection.png" alt="Search for invalid signatures via repeated bisection">
            <div class="image-caption">Figure 3: Search for invalid signatures via repeated bisection</div>
        </div>
        <p>We can perform a binary search over the buffered signatures to find any invalid signatures. Because we have authenticated messaging, we can also persistently block peers that send invalid signatures (prohibiting them from ever sending us a message again). With "traditional" gossip, this isn't safe to do (because the peer forwarding the message may simply tamper with a valid signature inflight). You can block a "traditional" peer but they can just move to a new address and restart the attack.</p>
        <div class="image-container">
            <img src="../imgs/blocking-peers.png" alt="Block peers that send invalid signatures">
            <div class="image-caption">Figure 4: Block peers that send invalid signatures</div>
        </div>
        <p>The result? Faster views and faster finality (1 batch verification of 2ms instead of 50 individual verifications of ~1ms). Could we have done parallelism? Yeah, but then we wouldn't have been able to scale as the network grows. Now running at 9% of CPU on a c7g.xlarge, there is 91% of CPU for your application to use. Consensus should be a sideshow.</p>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../shared.js"></script>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "07159b86f75b4af18e54dd0cda2fb4a7"}'></script>
</body>

</html>