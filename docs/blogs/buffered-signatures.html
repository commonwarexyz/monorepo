<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon">

    <title>commonware > Reducing Block Time (and Resource Usage) with Buffered Signatures</title>
    <meta name="description" content="How we achieved a 20% reduction in block time, 65% reduction in CPU usage, and 27% reduction in bandwidth by rethinking when and how we verify signatures.">
    <meta name="author" content="Patrick O'Grady">
    <meta name="keywords" content="commonware, open source, common goods, software, internet, ownership, trust, blockchain, decentralization, crypto">

    <meta property="og:url" content="https://commonware.xyz/blogs/buffered-signatures.html" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="commonware" />
    <meta property="og:image" content="https://commonware.xyz/imgs/buffering.png" />
    <meta property="og:title" content="Reducing Block Time (and Resource Usage) with Buffered Signatures" />
    <meta property="og:description" content="How we achieved a 20% reduction in block time, 65% reduction in CPU usage, and 27% reduction in bandwidth by rethinking when and how we verify signatures." />
    <meta property="article:author" content="https://x.com/_patrickogrady" />
    <meta property="article:published_time" content="2025-05-28T00:00:00Z" />
    <meta property="article:modified_time" content="2025-05-28T00:00:00Z" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content="commonware.xyz" />
    <meta property="twitter:url" content="https://commonware.xyz/blogs/buffered-signatures.html" />
    <meta property="twitter:title" content="Reducing Block Time (and Resource Usage) with Buffered Signatures" />
    <meta property="twitter:description" content="How we achieved a 20% reduction in block time, 65% reduction in CPU usage, and 27% reduction in bandwidth by rethinking when and how we verify signatures." />
    <meta property="twitter:image" content="https://commonware.xyz/imgs/buffering.png" />
    <meta property="twitter:site" content="@commonwarexyz" />
    <meta property="twitter:creator" content="@_patrickogrady" />

    <link rel="stylesheet" type="text/css" href="../style.css">
</head>

<body>
    <div id="logo-placeholder">
        <div class="logo-line">
            <span class="edge-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="edge-logo-symbol">*</span>
        </div>
        <div class="logo-line">
            <span class="vertical-logo-symbol">|</span>
            <span class="logo-text"> commonware </span>
            <span class="vertical-logo-symbol"> </span>
        </div>
        <div class="logo-line">
            <span class="edge-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="edge-logo-symbol">+</span>
        </div>
    </div>
    <div class="content">
        <h1>Reducing Block Time (and Resource Usage) with Buffered Signatures</h1>
        <div class="meta">
            <div class="author">By <a href="https://x.com/_patrickogrady">Patrick O'Grady</a></div>
            <div class="date">May 28, 2025</div>
        </div>
        <p>A few months ago, we launched <a href="https://x.com/_patrickogrady/status/1901645720823935341">Alto</a>, a minimal (and wicked fast) blockchain for continuously benchmarking the <a href="https://github.com/commonwarexyz/monorepo">Commonware Library</a>. Today, I'm thrilled <a href="https://alto.commonware.xyz">to share</a> that this benchmarking drove a 20% reduction in block time (to ~200ms), a 20% reduction in block finality (to ~300ms), and a 65% reduction in CPU usage.</p>
        <p>It turns out procrastinating, even in the world of consensus, can be a great strategy.</p>
        <h2>Laying the Foundation</h2>
        <p><a href="https://commonware.xyz/blogs/introducing-commonware.html">Last August</a>, we released the first <a href="https://github.com/commonwarexyz/monorepo">Commonware Library</a> primitive: <a href="https://docs.rs/commonware-p2p/latest/commonware_p2p/authenticated/index.html">p2p::authenticated</a>. Unlike traditional p2p libraries that specialize in gossip-based messaging over a subset of peers (identified by randomly generated IDs), <i>p2p::authenticated</i> provides point-to-point messaging between a swarm of fully-connected and authenticated peers (identified by some public key on an externally synchronized list, like a staking registry).</p>
        <div class="image-container">
            <img src="../imgs/gossip-models.png" alt="Comparing gossip models">
            <div class="image-caption">Figure 1: Comparing gossip models</div>
        </div>
        <p>The consensus primitives <a href="https://commonware.xyz/blogs/commonware-the-anti-framework.html">we released in December</a> (<a href="https://docs.rs/commonware-consensus/latest/commonware_consensus/simplex/index.html">consensus::simplex</a>) and <a href="https://commonware.xyz/blogs/threshold-simplex.html">January</a> (<a href="https://docs.rs/commonware-consensus/latest/commonware_consensus/threshold_simplex/index.html">consensus::threshold-simplex</a>) built on top of <i>p2p::authenticated</i> but didn't do anything particularly clever with it (the point-to-point messaging alone was enough of an improvement to reach the ~250ms block time in the original Alto launch).</p>
        <p>So, what would something clever look like?</p>
        <h2>Buffered Signature Verification</h2>
        <p>Seeking to progress through consensus as fast as possible, most consensus implementations verify signatures as soon as they are available (often in parallel to avoid slowing down the consensus state machine). This eager verification makes intuitive sense—you want to either enter a new view or finalize a block as soon as possible (and verifying a signature is a prerequisite for either).</p>
        <p>When peers are tasked with forwarding messages in traditional p2p, the recipient of a message can never be sure what they have (and what they have from whom) until verification. A malicious peer could forward a message with a valid signature, tamper with a signature over a message that someone did send (invalid signature), or even hallucinate a message that was never sent by a different peer (invalid signature).</p>
        <div class="image-container">
            <img src="../imgs/invalid-signature-gossip.png" alt="Block peers that send invalid signatures">
            <div class="image-caption">Figure 2: Block peers that send invalid signatures</div>
        </div>
        <p>With <i>p2p::authenticated</i>, we have the necessary functionality to do something novel: dedicated peer slots. Instead of verifying each peer signature individually as it arrives, we buffer messages in slots dedicated to each authenticated peer. When we collect a quorum (<i>2f+1</i>) of signatures over some message, we perform a single multi-signature verification (or batch verification if not using BLS12-381 signatures) instead of verifying each signature individually.</p>
        <div class="image-container">
            <img src="../imgs/buffering.png" alt="Buffer signatures until a quorum is reached">
            <div class="image-caption">Figure 3: Buffer signatures until a quorum is reached</div>
        </div>
        <h2>Handling Invalid Signatures</h2>
        <p>The tradeoff: now that we aren't verifying messages when they arrive over the wire, one bad apple can spoil the whole bunch.</p>
        <p>Fortunately, we have one more new tool from <i>p2p::authenticated</i> to help us: identity blocking. When a verification fails, a binary search is run over the buffered signatures to identify the bad apple(s). In the worst case (where <i>f</i> the signatures are invalid), this can lead to more verifications than the original eager approach. However, once identified as malicious, that peer is permanently blocked by its staking identity (and until the binary restarts, unable to send more invalid messages to us from any new address). Without this blocking, it would be trivial for a set of malicious peers to undermine this optimization (and make it worse than the original eager approach on each view). With identity-based blocking, however, bisection will only ever happen on a very small number of views over the course of a typical epoch. In a week-long 3,000,000 view epoch, a validator set of 1000 could at most cause disruption in ~333 views (0.011% of views).</p>
        <div class="image-container">
            <img src="../imgs/bisection.png" alt="Search for invalid signatures via repeated bisection">
            <div class="image-caption">Figure 4: Search for invalid signatures via repeated bisection</div>
        </div>
        <h2>Reducing Block Time (and Resource Usage)</h2>
        <p>By transitioning from individual signature verifications to 1-2 aggregate verifications per message, the performance of <a href="https://alto.commonware.xyz">Alto</a> improved significantly (while using less resources):</p>
        <ul>
            <li><b>Block time</b>: 250ms → 200ms (20% reduction)</li>
            <li><b>Finality</b>: 375ms → 300ms (20% reduction)</li>
            <li><b>CPU usage</b>: 26% → 9% on a <a href="https://github.com/commonwarexyz/alto/tree/main/chain#create-artifacts-1">c7g.xlarge</a> (65% reduction)</li>
        </ul>
        <p>The entire footprint of <i>p2p::authenticated</i> and <i>consensus::threshold-simplex</i> is now less than half a core, leaving plenty of compute available for your application to do more of whatever it does best.</p>
        <p>Consensus has often been the main attraction. At Commonware, we've been working hard to ensure it is a sideshow.</p>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../shared.js"></script>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "07159b86f75b4af18e54dd0cda2fb4a7"}'></script>
</body>

</html>