<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon">

    <title>commonware > Your p2p demo runs locally. Now what?</title>
    <meta name="description" content="You've built a peer-to-peer (p2p) demo that hums along on your local machine. Peers connect, messages flow, and for a moment, you're basking in localhost bliss. Then comes the inevitable question: how do you migrate this from your laptop to the cloud?">
    <meta name="author" content="Patrick O'Grady">
    <meta name="keywords" content="commonware, open source, common goods, software, internet, ownership, trust, blockchain, decentralization, crypto">

    <meta property="og:url" content="https://commonware.xyz/blogs/commonware-deployer.html" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="commonware" />
    <meta property="og:image" content="https://commonware.xyz/imgs/deployer-architecture.png" />
    <meta property="og:title" content="Your p2p demo runs locally. Now what?" />
    <meta property="og:description" content="You've built a peer-to-peer (p2p) demo that hums along on your local machine. Peers connect, messages flow, and for a moment, you're basking in localhost bliss. Then comes the inevitable question: how do you migrate this from your laptop to the cloud?" />
    <meta property="article:author" content="https://x.com/_patrickogrady" />
    <meta property="article:published_time" content="2025-03-05T00:00:00Z" />
    <meta property="article:modified_time" content="2025-03-05T00:00:00Z" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content="commonware.xyz" />
    <meta property="twitter:url" content="https://commonware.xyz/blogs/commonware-deployer.html" />
    <meta property="twitter:title" content="Your p2p demo runs locally. Now what?" />
    <meta property="twitter:description" content="You've built a peer-to-peer (p2p) demo that hums along on your local machine. Peers connect, messages flow, and for a moment, you're basking in localhost bliss. Then comes the inevitable question: how do you migrate this from your laptop to the cloud?" />
    <meta property="twitter:image" content="https://commonware.xyz/imgs/deployer-architecture.png" />
    <meta property="twitter:site" content="@commonwarexyz" />
    <meta property="twitter:creator" content="@_patrickogrady" />

    <link rel="stylesheet" type="text/css" href="../style.css">
</head>

<body>
    <div id="logo-placeholder">
        <div class="logo-line">
            <span class="edge-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="edge-logo-symbol">*</span>
        </div>
        <div class="logo-line">
            <span class="vertical-logo-symbol">|</span>
            <span class="logo-text"> commonware </span>
            <span class="vertical-logo-symbol"> </span>
        </div>
        <div class="logo-line">
            <span class="edge-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">~</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">+</span>
            <span class="horizontal-logo-symbol"> </span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="horizontal-logo-symbol">*</span>
            <span class="horizontal-logo-symbol">-</span>
            <span class="edge-logo-symbol">+</span>
        </div>
    </div>
    <div class="content">
        <h1>Your p2p demo runs locally. Now what?</h1>
        <div class="meta">
            <div class="author">By <a href="https://x.com/_patrickogrady">Patrick O'Grady</a></div>
            <div class="date">March 5, 2025</div>
        </div>
        <p>You've built a peer-to-peer (p2p) demo that hums along on your local machine. Peers connect, messages flow, and for a moment, you're basking in localhost bliss. Then comes the inevitable question: how do you migrate this from your laptop to the cloud?</p>
        <p>Enter <a href="https://docs.rs/commonware-deployer">deployer</a>, a CLI and library designed to bridge the gap between localhost and monitored, multi-region infrastructure. It's not just about spinning up a handful of serversâ€”it's about rolling custom binaries and configurations to instances in multiple regions, configuring networking policies to allow peers to talk to each other and to push metrics to a private monitoring stack, and cleaning up when you're done.</p>
        <p><i>deployer</i> takes care of infrastructure, so you can focus on coding.</p>
        <h2>From Localhost to the Cloud: The Manual Way</h2>
        <p>Deploying a p2p application isn't like spinning up a web server. You'll need to reckon with:</p>
        <ul>
            <li><b>Networking</b>: How do your nodes discover each other across regions?</li>
            <li><b>Deployment</b>: How do you push unique binaries and configs to each instance?</li>
            <li><b>Observability</b>: When a node in Brazil starts acting up, how do you know?</li>
            <li><b>Cleanup</b>: When you're done, how do you ensure you don't leave a mess behind?</li>
        </ul>
        <p>You could spend weeks configuring VPC peering, wrestling with IAM roles, and praying that your Grafana dashboard actually shows something useful. Or, you could use <a href="https://docs.rs/commonware-deployer">deployer</a>.</p>
        <h2>Introducing Deployer</h2>
        <p><i>deployer</i> is your one-stop shop for deploying p2p applications to the cloud. It's both a CLI for quick wins and a Rust library when you need to get fancy. Think of it like a high-level abstraction over infrastructure APIs with sane defaults and observability built-in. The first <i>deployer</i> dialect, <a href="https://docs.rs/commonware-storage/latest/commonware_storage/bmt/index.html">deployer::ec2</a>, is focused on reproducible benchmarking. Here's what it does (via a single YAML config):</p>
        <ol>
            <li><b>Automated Provisioning</b>: Spins up EC2 instances in multiple regions, sets up VPCs, internet gateways, route tables, subnets, security groups, SSH keys, and connects everything together with VPC peering.</li>
            <li><b>Code Deployment</b>: Uploads your binaries and configs (specified uniquely for each instance), installs everything as a systemd service, and starts everything up. Push tweaks without redeploying.</li>
            <li><b>Configured Monitoring</b>: Launches a dedicated monitoring instance (with Prometheus, Grafana, and Loki) configured to pull data from all deployed instances.</li>
            <li><b>1-Command Cleanup</b>: <i>deployer</i> destroys everything when you're done, leaving no trace or surprise charges.</li>
        </ol>
        <div class="image-container">
            <img src="../imgs/deployer-architecture.png" alt="Deployment of custom binaries across multiple AWS regions">
            <div class="image-caption">Figure 1: Deployment of custom binaries across multiple AWS regions</div>
        </div>
        <h2>Try it Out: Flood</h2>
        <p>To demonstrate how to use <i>deployer</i>, we build a <a href="https://docs.rs/commonware-p2p/latest/commonware_p2p/authenticated/index.html">p2p::authenticated</a> benchmarking tool called <a href="https://docs.rs/commonware-flood">flood</a>. Flood does one thing: spam peers with as many random messages as possible.</p>
        <p>Flood leverages <i>deployer</i> to turn a local stress test into a global one. Here's how it works:</p>
        <ol>
            <li><b>Setup</b>: The setup binary (included in the `flood` crate) generates a config.yaml file along with peer-specific configs and a peers.yaml file. You specify the number of peers, bootstrappers, regions, and performance parameters like message size and message backlog.</li>
            <li><b>Compile</b> Flood uses Docker to compile the flood binary for ARM64 (deployer uses Graviton EC2 instances).</li>
            <li><b>Deploy</b> Run `deployer ec2 create` to launch the flood network. Deployer spins up instances across regions, wires them together, and starts the flood binary on each peer.</li>
            <li><b>Monitor</b> Check the Grafana dashboard at `http://monitoring-ip:3000/d/flood` to see message throughput, latency, and instance health.</li>
            <li><b>Tweak</b> Want to test a new message size? Update the config, run `deployer ec2 update`, and watch the floodgates open.</li>
            <li><b>Cleanup</b> When you're done, `deployer ec2 destroy` wipes the network clean.</li>
        </ol>
        <p>Check out the full walkthrough in the <a href="https://github.com/commonwarexyz/monorepo/blob/main/examples/flood/README.md">README</a>.</p>
        <div class="image-container">
            <img src="../imgs/flood-grafana.png" alt="Automatically deployed Grafana dashboard for Flood">
            <div class="image-caption">Figure 2: Automatically deployed Grafana dashboard for Flood</div>
        </div>
        <p>A local demo is a proof of concept; <i>deployer::ec2</i> makes it a proving ground.</p>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../shared.js"></script>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "07159b86f75b4af18e54dd0cda2fb4a7"}'></script>
</body>

</html>